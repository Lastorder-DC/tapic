<html>
<head>
	<script src="twapi.js"></script>
</head>
<body>

<div id="chat" style="overflow: hidden; word-wrap: break-word; height: 800px; width: 800px;">
</div>



<script>
	var clientid = ''; // public client id
	var oauth = ''; // oauth without "oauth:", requires chat_login, channel_editor
	// channel_commercial (if you want to run commercials), channel_check_subscription (if you want to check subscriber status)

	// Do this first
	TWAPI.setup( clientid, oauth, function( username ) {
		// This is also required for a lot of things to work
		var channel = username;
		TWAPI.runChat( channel, function() {
			// Run test functions after joining a chat
			tests();
		} );
	} );

	// EventListeners
	document.addEventListener('twapiRaw', function( e ) {
		// You really don't NEED to see raw messages. But you can if you want.
		// You can also manually parse the raw messages if you don't trust TWAPI.js
		// writeChat( '* ' + e.detail );
	} );

	document.addEventListener('twapiRawGroup', function( e ) {
		// You really don't NEED to see raw messages from the group server. But you can if you want.
		// You can also manually parse the raw messages from the group server if you don't trust TWAPI.js
		// writeChat( '+ ' + e.detail );
	} );

	document.addEventListener('twapiNotice', function( e ) {
		writeChat( e.detail );
	} );

	document.addEventListener('twapiJoin', function( e ) {
		writeChat( e.detail + ' has joined.' );
	} );

	document.addEventListener('twapiPart', function( e ) {
		writeChat( e.detail + ' has left the channel.' );
	} );

	document.addEventListener('twapiClearUser', function( e ) {
		writeChat( e.detail + ' has been purged/timed out.' );
	} );
	
	document.addEventListener('twapiClearChat', function( e ) {
		writeChat( 'Chat has been cleared.' );
	} );

	document.addEventListener('twapiHost', function( e ) {
		writeChat( e.detail + ' is hosting you.' );
	} );

	document.addEventListener('twapiFollow', function( e ) {
		writeChat( e.detail + ' has followed you.' );
	} );

	document.addEventListener('twapiSub', function( e ) {
		writeChat( e.detail + ' has just subscribed!' );
	} );

	document.addEventListener('twapiSubMonths', function( e ) {
		writeChat( e.detail.name + ' has resubbed ' + e.detail.months + ' times!' );
	} );

	document.addEventListener('twapiSubsAway', function( e ) {
		writeChat( e.detail + ' users have subbed since you have been offline.' );
	} );

	document.addEventListener('twapiRoomstate', function( e ) {
		var output = 'Roomstate options: ';
		if ( e.detail.lang ) output += ' lang:' + e.detail.lang;
		if ( e.detail.r9k ) output += ' r9k';
		if ( e.detail.slow ) output += ' slow';
		if ( e.detail.subs_only ) output += ' subs-only';
		if ( !e.detail.lang && !e.detail.r9k && !e.detail.slow && !e.detail.subs_only ) {
			output += ' none.';
		}
		writeChat( output );
	} );

	document.addEventListener('twapiMsg', function( e ) {
		var output = (e.detail.mod ? '<img src="http://chat-badges.s3.amazonaws.com/mod.png">' : '') +
			(e.detail.sub  ?'<img src="' + TWAPI.getSubBadgeUrl() + '">' : '') +
			(e.detail.turbo ? '<img src="http://chat-badges.s3.amazonaws.com/turbo.png">' : '') +
			(e.detail.streamer ? '<img src="http://chat-badges.s3.amazonaws.com/broadcaster.png">' : '') +
			'<strong style="color: ' + e.detail.color + ';">' +
			e.detail.from +
			'</strong>&nbsp;' +
			(e.detail.action ? '<span style="color: ' + e.detail.color + ';">' : ':&nbsp;&nbsp;') +
			e.detail.text +
			(e.detail.action ? '</span>' : '' );

			// e.detail.emotes is the emotes, e.g. '25:0-4,12-16/1902:6-10'
			// https://github.com/justintv/Twitch-API/blob/master/IRC.md#privmsg
		writeChat( output );
	} );

	document.addEventListener('twapiNoticeGroup', function( e ) {
		writeChat( e.detail );
	} );

	document.addEventListener('twapiWhisper', function( e ) {
		var output = (e.detail.turbo ? '<img src="http://chat-badges.s3.amazonaws.com/turbo.png">' : '') +
			'<strong style="color: ' + e.detail.color + ';">' +
			e.detail.from +
			'</strong>' +
			' &gt; ' +
			'<strong>' + e.detail.to + '</strong> : ' +
			e.detail.text;
		// e.detail.message_id & e.detail.thread_id & e.detail.user_id contain their respective ids
		// When using whispers for a bot, be sure to whitelist it: https://discuss.dev.twitch.tv/t/are-your-whispers-not-going-through-for-your-bot/5183/3
		writeChat( output );
	} );

	// Utility functions
	function tests() {
		// TWAPI.sendChat( 'Hello world!' );
		// TWAPI.sendWhisper( 'littlecatbot', 'Hello whisper!' );
		// TWAPI.changeChannel( 'letsmakefriends' ); 
		console.log( 'getUsername: ' + TWAPI.getUsername() );
		console.log( 'getChannel: ' + TWAPI.getChannel() );
		console.log( 'getGame: ' + TWAPI.getGame() );
		console.log( 'getStatus: ' + TWAPI.getStatus() );
		console.log( 'getFollowerCount: ' + TWAPI.getFollowerCount() );
		console.log( 'getTotalViewCount: ' + TWAPI.getTotalViewCount() );
		console.log( 'getCurrentViewCount: ' + TWAPI.getCurrentViewCount() );
		console.log( 'getCreatedAt: ' + TWAPI.getCreatedAt() );
		console.log( 'getLogo: ' + TWAPI.getLogo() );
		console.log( 'getVideoBanner: ' + TWAPI.getVideoBanner() );
		console.log( 'getProfileBanner: ' + TWAPI.getProfileBanner() );

		var folUser = 'skhmt';
		var folTarget = 'letsmakefriends';
		TWAPI.isFollowing( folUser, folTarget, function( res ) {
			if ( res.isFollowing ) console.log( folUser + ' has been following ' + folTarget + ' since: ' + res.dateFollowed );
			else console.log( folUser + ' is not following ' + folTarget + '.' );
		} );

		// // Requires 'channel_check_subscription'
		// var subUser = 'skhmt';
		// var subChannel = 'letsmakefriends';
		// TWAPI.isSubscribing( subUser, subChannel, function( res ) {
		// 	if ( res.isSubscribing ) console.log( subUser + ' has been subbed to ' + subChannel + ' since: ' + res.dateSubscribed );
		// 	else console.log( subUser + ' is not subbed to ' + subChannel + '.' );
		// } );

		console.log( 'isPartner: ' + TWAPI.isPartner() );
		console.log( 'getSubBadgeUrl: ' + TWAPI.getSubBadgeUrl() );
		// TWAPI.runCommercial('30'); // requires 'channel_commercial'

		console.log( 'isOnline: ' + TWAPI.isOnline() );
		console.log( 'getFps: ' + TWAPI.getFps() );
		console.log( 'getVideoHeight: ' + TWAPI.getVideoHeight() );
		console.log( 'getDelay: ' + TWAPI.getDelay() );
		console.log( 'getChatters: ' + JSON.stringify( TWAPI.getChatters() ) );

		// TWAPI.setStatusGame('Making a Twitch Javascript Framework #programming', 'Creative');
		// TWAPI.closeChat();
	}

	function writeChat(msg) {
		document.getElementById('chat').innerHTML += msg + '<br>';
		document.getElementById('chat').scrollTop = Number.MAX_SAFE_INTEGER;
	}
</script>

</body>
</html>
