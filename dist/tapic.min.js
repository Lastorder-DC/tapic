/**
 * @overview Twitch API & Chat in javascript.
 * @author Skhmt
 * @license MIT
 * @version 3.1.4
 */

 (function(){function u(){function q(a){var c=new Map;a=a.substring(1).split(";");for(var f=0;f<a.length;f++){var e=a[f].split("=");c.set(e[0],e[1])}return c}function p(a,c){if(e){var f=!1,d=!1,t=!1,k=!1;n("https://api.twitch.tv/kraken/streams/"+e+"?client_id="+h+"&api_version=3",function(a){a.stream?(v=!0,C=a.stream.viewers,G=a.stream.average_fps,H=a.stream.video_height,I=a.stream.delay):v=!1;(f=!0,d)&&t&&k&&"function"==typeof c&&c()});n("https://api.twitch.tv/kraken/channels/"+e+"?client_id="+h+
 "&api_version=3",function(a){y=a.game;z=a.status;J=a.followers;K=a.views;D=a.partner;L=a.created_at;M=a.logo;N=a.video_banner;O=a.profile_banner;d=!0;f&&d&&t&&k&&"function"==typeof c&&c()});n("https://api.twitch.tv/kraken/channels/"+e+"/follows?client_id="+h+"&api_version=3&limit=100",function(a){if(a.follows){var e=!0;0<E.length&&(e=!1);for(var h=0;h<a.follows.length;h++){var b=a.follows[h].user.display_name;-1===E.indexOf(b)&&(e||m("follow",b),E.push(b))}t=!0;f&&d&&t&&k&&"function"==typeof c&&c()}});
 n("https://tmi.twitch.tv/group/user/"+e+"/chatters?client_id="+h+"&api_version=3",function(a){r||(a=a.data);if(!a.chatters)return console.log("No response for user list.");C=a.chatter_count;w.moderators=a.chatters.moderators.slice();w.staff=a.chatters.staff.slice();w.admins=a.chatters.admins.slice();w.global_mods=a.chatters.global_mods.slice();w.viewers=a.chatters.viewers.slice();k=!0;f&&d&&t&&k&&"function"==typeof c&&c()});setTimeout(function(){r||(document.getElementById("tapicJsonpContainer").innerHTML=
 "");p(a)},1E3*a)}}function W(a){n("https://api.twitch.tv/kraken/chat/"+e+"/badges?api_version=3&client_id="+h,function(c){c.subscriber&&(P=c.subscriber.image);"function"==typeof a&&a()})}function n(a,c){if("function"!==typeof c)return console.error("Callback needed.");if(r)require("https").get(a,function(a){var f="";a.setEncoding("utf8");a.on("data",function(a){f+=a});a.on("end",function(){200<=a.statusCode&&400>a.statusCode?c(JSON.parse(f)):console.error(f)})}).on("error",function(a){console.error(a.message)});
 else{var f;do f="tapicJSONP"+Math.floor(65536*Math.random());while(window[f]);window[f]=function(a){c(a);delete window[f]};var e=document.createElement("script");e.src=a+"&callback="+f;document.getElementById("tapicJsonpContainer").appendChild(e)}}function m(a,c){if(x.has(a))for(var f=x.get(a),e=0;e<f.length;e++)f[e](c)}var d={},h="",A="",F="",k,r=!1,x=new Map,e="",v=!1,y="",z="",J="",K="",D="",C="",G="",H="",I="",P="",w={},E=[],L="",M="",N="",O="",u="",U="",V="",Q="",R="",S="",T="";"undefined"!==
 typeof module&&"undefined"!==typeof module.exports&&(r=!0);d.setup=function(a,c,f){"string"!=typeof a||"string"!=typeof c?console.error("Invalid parameters. Usage: TAPIC.setup(clientid, oauth[, callback]);"):(h=a,A=c.replace("oauth:",""),r||(a=document.createElement("div"),a.id="tapicJsonpContainer",a.style.cssText="display:none;",document.getElementsByTagName("body")[0].appendChild(a)),n("https://api.twitch.tv/kraken?client_id="+h+"&oauth_token="+A+"&api_version=3",function(a){function c(){k.send("CAP REQ :twitch.tv/tags twitch.tv/commands twitch.tv/membership");
 k.send("PASS oauth:"+A);k.send("NICK "+F)}function d(a){a=r?a.split("\r\n"):a.data.split("\r\n");for(var c=0;c<a.length;c++){var h=a[c];if("PING :tmi.twitch.tv"===h)k.send("PONG :tmi.twitch.tv");else if(h){var b=h;m("raw",b);b=b.split(" ");if("PRIVMSG"===b[2]){var l=b,b=q(l[0]);b.get("display-name")||b.set("display-name",l[1].split("!")[0].substring(1));b.get("color")||b.set("color","#d2691e");b.set("badges",b.get("badges").split(","));var g=!1,l=l.slice(4);l[0]=l[0].substring(1);"\u0001ACTION"===
 l[0]&&(l=l.slice(1),g=!0);var B=l.join(" ").replace(/</g,"&lt;").replace(/>/g,"&gt;");"twitchnotify"===b.get("display-name")?"just"===l[1]?m("sub",l[0]):m("subsAway",l[0]):m("message",{from:b.get("display-name"),color:b.get("color"),mod:1==b.get("mod"),sub:1==b.get("subscriber"),turbo:1==b.get("turbo"),streamer:b.get("display-name").toLowerCase()===e.toLowerCase(),action:g,text:B,emotes:b.get("emotes"),badges:b.get("badges"),room_id:b.get("room-id"),user_id:b.get("user-id")})}else if("PRIVMSG"===
 b[1])m("host",b[3].substring(1));else if("NOTICE"===b[2])b.splice(0,4),b=b.join(" ").substring(1),m("notice",b);else if("JOIN"===b[1])b=b[0].split("!")[0].substring(1),m("join",b);else if("PART"===b[1])b=b[0].split("!")[0].substring(1),m("part",b);else if("ROOMSTATE"===b[2])b=q(b[0]),m("roomstate",{lang:b.get("broadcaster-lang"),r9k:b.get("r9k"),slow:b.get("slow"),subs_only:b.get("subs-only")});else if("WHISPER"===b[2])g=q(b[0]),g.get("display-name")||g.set("display-name",b[1].split("!")[0].substring(1)),
 g.get("color")||g.set("color","#d2691e"),g.set("badges",g.get("badges").split(",")),l=b.slice(4).join(" ").substring(1),m("whisper",{from:g.get("display-name"),to:b[3],color:g.get("color"),emotes:g.get("emotes"),turbo:g.get("turbo"),message_id:g.get("message-id"),thread_id:g.get("thread-id"),user_id:g.get("user-id"),text:l,badges:g.get("badges")});else if("CLEARCHAT"===b[1])m("clearChat");else if("CLEARCHAT"===b[2]){for(var l=b,B=l[0].slice(1).split(";"),b="",g=1,t=0;t<B.length;t++){var n=B[t].split("=");
 "ban-duration"===n[0]?g=n[1]:"ban-reason"===n[0]&&(b=n[1].replace(/\\s/g," "))}l=l[4].slice(1);m("clearUser",{name:l,reason:b,duration:g})}else"USERSTATE"===b[2]?(b=q(b[0]),U=b.get("color"),u=b.get("display-name"),V=b.get("emote-sets"),Q=b.get("mod"),R=b.get("subscriber"),S=b.get("turbo"),T=b.get("user-type")):"USERNOTICE"===b[2]&&(g=b,b=q(g[0]),g=g.slice(4).join(" ").substring(1),m("subMonths",{name:b.get("display-name"),months:b.get("msg-param-months"),message:g}));":tmi.twitch.tv 001"===h.substring(0,
 18)&&"function"==typeof f&&f(F)}}}F=a.token.user_name;k=r?new (require("ws"))("wss://irc-ws.chat.twitch.tv:443"):new WebSocket("wss://irc-ws.chat.twitch.tv:443");r?(k.on("open",c),k.on("message",d)):(k.onopen=c,k.onmessage=d)}))};d.joinChannel=function(a,c){if("string"!=typeof a)console.error("Invalid parameters. Usage: TAPIC.joinChannel(channel);");else{if(!k)return console.error("Tapic not setup.");e&&k.send("PART #"+e);e=a.replace("#","");v=!1;P=I=H=G=C=D=K=J=z=y="";w={};E=[];T=S=R=Q=O=N=M=L="";
 k.send("JOIN #"+e);W();"function"==typeof c?p(5,c):p(5)}};d.sendChat=function(a){if("string"!=typeof a)console.error("Invalid parameters. Usage: TAPIC.sendChat(message);");else{if(!k)return console.error("Tapic not setup.");k.send("PRIVMSG #"+e+" :"+a);m("echoChat",a)}};d.sendWhisper=function(a,c){if("string"!=typeof a||"string"!=typeof c)console.error("Invalid parameters. Usage: TAPIC.sendWhisper(user, message);");else{if(!k)return console.error("Tapic not setup.");k.send("PRIVMSG #jtv :/w "+a+" "+
 c);m("echoWhisper",{to:a,text:c})}};d.getUsername=function(){return F};d.getChannel=function(){return e};d.isOnline=function(){return e?v:console.error("Not in a channel.")};d.getStatus=function(){return e?z:console.error("Not in a channel.")};d.getGame=function(){return e?y:console.error("Not in a channel.")};d.getFollowerCount=function(){return e?J:console.error("Not in a channel.")};d.getTotalViewCount=function(){return e?K:console.error("Not in a channel.")};d.isPartner=function(){return e?D:
 console.error("Not in a channel.")};d.getCurrentViewCount=function(){return e?C:console.error("Not in a channel.")};d.getFps=function(){return v?G:console.error("Stream not online.")};d.getVideoHeight=function(){return v?H:console.error("Stream not online.")};d.getDelay=function(){return v?I:console.error("Stream not online.")};d.getSubBadgeUrl=function(){return e?P:console.error("Not in a channel.")};d.getChatters=function(){return e?w:console.error("Not in a channel.")};d.getCreatedAt=function(){return e?
 L:console.error("Not in a channel.")};d.getLogo=function(){return e?M:console.error("Not in a channel.")};d.getVideoBanner=function(){return e?N:console.error("Not in a channel.")};d.getProfileBanner=function(){return e?O:console.error("Not in a channel.")};d.getDisplayName=function(){return e?u:console.error("Not in a channel.")};d.getColor=function(){return e?U:console.error("Not in a channel.")};d.getEmoteSets=function(){return e?V:console.error("Not in a channel.")};d.getMod=function(){return e?
 1==Q:console.error("Not in a channel.")};d.getSub=function(){return e?1==R:console.error("Not in a channel.")};d.getTurbo=function(){return e?1==S:console.error("Not in a channel.")};d.getUserType=function(){return e?T:console.error("Not in a channel.")};d.isFollowing=function(a,c,e){"string"!=typeof a||"string"!=typeof c||"function"!=typeof e?console.error("Invalid parameters. Usage: TAPIC.isFollowing(user, channel, callback);"):n("https://api.twitch.tv/kraken/users/"+a+"/follows/channels/"+c+"?api_version=3&client_id="+
 h,function(a){a.error?e({isFollowing:!1}):e({isFollowing:!0,dateFollowed:(new Date(a.created_at)).toLocaleString()})})};d.isSubscribing=function(a,c,f){"string"!=typeof a||"function"!=typeof f?console.error("Invalid parameters. Usage: TAPIC.isSubscribing(user, callback);"):n("https://api.twitch.tv/kraken/channels/"+e+"/subscriptions/"+a+"?api_version=3client_id="+h,function(a){a.error?f({isSubscribing:!1}):f({isSubscribing:!0,dateSubscribed:(new Date(a.created_at)).toLocaleString()})})};d.runCommercial=
 function(a){if("number"!=typeof a)console.error("Invalid parameters. Usage: TAPIC.runCommercial(length);");else{if(!e)return console.error("Not in a channel.");if(!D)return console.error("Not a partner, cannot run a commercial.");var c="/kraken/channels/"+e+"/commercial?oauth_token="+A,f="https://api.twitch.tv"+c;r?(f={host:"https://api.twitch.tv",path:c,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","Client-ID":h}},require("https").request(f).write("length="+
 a).end()):(c=new XMLHttpRequest,c.open("POST",f,!0),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),c.setRequestHeader("Client-ID",h),c.send("length="+a))}};d.setStatusGame=function(a,c){if("string"!=typeof a||"string"!=typeof c)console.error("Invalid parameters. Usage: TAPIC.setStatusGame(status, game);");else{var f="/kraken/channels/"+e,f=f+("?channel[status]="+encodeURIComponent(a)),f=f+("&channel[game]="+encodeURIComponent(c)),f=f+("&_method=put&oauth_token="+
 A);if(r)f={host:"https://api.twitch.tv",path:f,headers:{"Client-ID":h}},require("https").get(f,function(a){var c="";a.setEncoding("utf8");a.on("data",function(a){c+=a});a.on("end",function(){if(200<=a.statusCode&&400>a.statusCode){var d=JSON.parse(c);y=d.game;z=d.status}else console.error(c)})}).on("error",function(a){console.error(a.message)});else{var d=new XMLHttpRequest;d.open("GET","https://api.twitch.tv"+f,!0);d.setRequestHeader("Client-ID",h);d.onload=function(){if(200<=d.status&&400>d.status){var a=
 JSON.parse(d.responseText);y=a.game;z=a.status}else console.error(d.responseText)};d.onerror=function(){console.error(d.responseText)};d.send()}}};d.listen=function(a,c){if("string"!=typeof a)console.error("Invalid parameters. Usage: TAPIC.listen(eventName[, callback]);");else{if("function"!==typeof c)return console.error("Callback needed.");if(x.has(a)){var d=x.get(a);d.push(c);x.set(a,d)}else x.set(a,[c])}};d.emit=function(a,c){"string"!=typeof a||"string"!=typeof c?console.error("Invalid parameters. Usage: TAPIC.emit(eventName, eventDetail);"):
 m(a,c)};return d}"function"!==typeof Map&&(window.Map=function(){var q=Object.create(null),p={size:0,get:function(p){return q[p]},set:function(u,n){q[u]=n;p.size++},has:function(p){return!!q[p]},clear:function(){q=Object.create(null);p.size=0}};return p});"undefined"!==typeof module&&"undefined"!==typeof module.exports?module.exports=u():"undefined"===typeof TAPIC?window.TAPIC=u():console.error("TAPIC already defined.")})();
